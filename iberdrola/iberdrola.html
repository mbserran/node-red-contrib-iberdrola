<!--
  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

  http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<script type="text/x-red" data-template-name="iberdrola">
    <div class="form-row">
        <label for="node-input-user"><i class="fa fa-user"></i> User</label>
        <input type="text" id="node-input-user" placeholder="">
    </div>
	<div class="form-row">
        <label for="node-input-password"><i class="fa fa-key"></i> Password</label>
        <input type="password" id="node-input-password" placeholder="">
    </div>
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
</script>

<script type="text/x-red" data-help-name="iberdrola">
    <p>Gets the data consumption and production data from Iberdrola I-DE distribution using the credentials provided</p>

    <h3>Inputs</h3>
		<dl class="message-properties">
		  <dt class="optional">user <span class="property-type">string</span></dt>
		  <dd> If not set in the node configuration panel, this property specifies the <code>user</code> to be used. </dd>
		</dl>
		<dl class="message-properties">
		  <dt class="optional">password <span class="property-type">string</span></dt>
		  <dd> If not set in the node configuration panel, this property sets the <code>password</code> to be used. </dd>
		</dl>
		<dl class="message-properties">
		  <dt class="optional">payload <span class="property-type">string (date formatted)</span></dt>
		  <dd> This property is used to pass the <code>date</code> corresponding to the data to be extracted. </dd>
		</dl>

	  <h3>Outputs</h3>
		<dl class="message-properties">
		  <dt>payload <span class="property-type">object</span></dt>
		  <dd> The returned value is an obeject with the following format <code>{Dia: day extracted, Import: Consumption array 24h, Export: Generation array 24h, Count: readings left}</code>.</dd>
		</dl>
		<dl class="message-properties">
		  <dt>topic <span class="property-type">number</span></dt>
		  <dd> The returned value is the contract code whose readings have been retrieved in <code>msg.payload</code>.</dd>
		</dl>

	  <h3>Details</h3>
		<p>The node is used to connect to the Iberdrola I-DE with your personal access credentials to read the consumption and generation readings of one full day selected in <code>msg.payload</code>.<br>
		Your credentials can be introduced in the node configuration or passed through the input messages <br>
		The returned object will be complete if <code>Count</code> is zero. If it is negative it indicates the parts that are left or not available. <br></p>

	  <h3>References</h3>
		<ul>
		  <li><a href="https://github.com/mbserran/node-red-contrib-iberdrola">GitHub</a> - the nodes github repository</li>
		</ul>

</script>

<script type="text/javascript">
    RED.nodes.registerType('iberdrola',{
        category: 'network',
        color:"#00913f",
        defaults: {
            name: {value:""},
            user: {value:""},
            password: {value:""}
        },
        inputs:1,
        outputs:1,
        icon: "font-awesome/fa-cloud-download",
        label: function() {
            return this.name || this.host || 'iberdrola';
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>
